<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ìƒí™œ ì˜·ì°¨ë¦¼ ì‹œë®¬ë ˆì´í„°</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      background: linear-gradient(180deg, #fdf6e3, #f0f6ff);
    }
    .app {
      max-width: 960px;
      width: 100%;
      margin: 24px;
      padding: 22px 20px 26px;
      background: #ffffffcc;
      border-radius: 16px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.06);
    }
    h1 {
      text-align: center;
      margin: 0 0 10px;
      font-size: 24px;
    }
    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #555;
      margin-bottom: 20px;
    }
    .screen { display: none; }
    .screen.active { display: block; }

    .scenario-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
      margin-top: 10px;
    }
    .scenario-card {
      background: #fff;
      border-radius: 12px;
      padding: 12px 12px 14px;
      border: 1px solid #e3e3e3;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
      position: relative;
    }
    .scenario-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.06);
      border-color: #92c5ff;
    }
    .scenario-card.selected {
      border-color: #4b8cf5;
      box-shadow: 0 8px 22px rgba(75,140,245,0.25);
    }
    .scenario-title {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 2px;
    }
    .scenario-emoji {
      font-size: 24px;
      margin-right: 6px;
    }
    .scenario-desc {
      font-size: 13px;
      color: #555;
      margin-bottom: 4px;
    }
    .scenario-meta {
      font-size: 11px;
      color: #777;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #f0f4ff;
      color: #3b5a9b;
      margin-right: 4px;
    }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    button {
      border-radius: 999px;
      padding: 8px 16px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      background: #4b8cf5;
      color: white;
      box-shadow: 0 4px 10px rgba(75,140,245,0.35);
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.1s ease;
    }
    button:hover {
      background: #3a78dd;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(75,140,245,0.4);
    }
    button.secondary {
      background: #e5ebf5;
      color: #333;
      box-shadow: none;
    }
    button.secondary:hover {
      background: #d4deee;
      box-shadow: none;
    }
    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      box-shadow: none;
    }

    .story-page {
      min-height: 160px;
      background: #fff;
      border-radius: 12px;
      padding: 16px 14px;
      border: 1px dashed #e0cfa6;
      position: relative;
      overflow: hidden;
    }
    .story-badge {
      position: absolute;
      top: 10px;
      right: 12px;
      font-size: 11px;
      color: #777;
      background: #fdf0d0;
      padding: 3px 8px;
      border-radius: 999px;
    }
    .story-text {
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-line;
    }
    .story-page-index {
      margin-top: 8px;
      font-size: 12px;
      text-align: right;
      color: #666;
    }

    .builder-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }
    .group-card {
      background: #fff;
      border-radius: 12px;
      padding: 10px 10px 12px;
      border: 1px solid #e4e4e4;
    }
    .group-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .group-subtitle {
      font-size: 11px;
      color: #777;
      margin-bottom: 6px;
    }
    .item-option {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      font-size: 13px;
      padding: 4px 0;
    }
    .item-option input {
      margin-top: 3px;
    }
    .item-main {
      font-weight: 500;
    }
    .item-meta {
      font-size: 11px;
      color: #666;
    }
    .summary-box {
      background: #fff;
      border-radius: 12px;
      padding: 12px 12px 10px;
      border: 1px solid #e4e4e4;
      margin-top: 10px;
      font-size: 13px;
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    .summary-label { color: #666; }
    .summary-value { font-weight: 600; }

    .status-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #555;
      margin-bottom: 6px;
    }

    .result-main-score {
      font-size: 20px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 6px;
    }
    .result-badge {
      text-align: center;
      font-size: 13px;
      margin-bottom: 10px;
      color: #555;
    }
    .feedback-box {
      background: #fff;
      border-radius: 12px;
      padding: 12px 12px 14px;
      border-left: 5px solid #4b8cf5;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-line;
    }
    .feedback-box.good {
      border-left-color: #4caf50;
      background: #f5fff6;
    }
    .feedback-box.bad {
      border-left-color: #f44336;
      background: #fff6f5;
    }
    .result-list {
      margin-top: 10px;
      font-size: 13px;
    }
    .result-list ul {
      padding-left: 18px;
      margin: 4px 0 0;
    }

    @media (max-width: 600px) {
      .app {
        margin: 12px;
        padding: 18px 14px 20px;
      }
      h1 { font-size: 20px; }
    }
  </style>
</head>
<body>
<div class="app">
  <h1>ì•ˆì „í•˜ê³  ê±´ê°•í•œ ì˜ìƒí™œ ì‹œë®¬ë ˆì´í„°</h1>
  <div class="subtitle">
    5í•™ë…„ ì‹¤ê³¼ &lt;ì•ˆì „í•˜ê³  ê±´ê°•í•œ ì˜ìƒí™œ&gt; ìƒí™©ë³„ ì˜·ì°¨ë¦¼ ì—°ìŠµ
  </div>

  <!-- 1. ìƒí™© ì„ íƒ -->
  <div id="screen-scenario" class="screen active">
    <h2>1ë‹¨ê³„. ì–´ë–¤ ìƒí™©ì—ì„œ ì˜·ì„ ì…ì„ê¹Œìš”?</h2>
    <p style="font-size:13px;color:#555;margin-top:4px;">
      ìƒí™©ì„ í•˜ë‚˜ ê³ ë¥¸ ë’¤, ê·¸ ìƒí™©ì— ì–´ìš¸ë¦¬ëŠ” ì˜·ì°¨ë¦¼ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.
    </p>
    <div id="scenarioGrid" class="scenario-grid"></div>
    <div class="btn-row">
      <button id="btnScenarioNext" disabled>ì´ ìƒí™©ìœ¼ë¡œ ì´ì•¼ê¸° ì‹œì‘í•˜ê¸° â–¶</button>
    </div>
  </div>

  <!-- 2. ìŠ¤í† ë¦¬ -->
  <div id="screen-story" class="screen">
    <h2>2ë‹¨ê³„. ì§§ì€ ë™í™” ì† ìƒí™© ì•Œì•„ë³´ê¸°</h2>
    <div class="status-row">
      <div id="storyScenarioTitle"></div>
      <div id="storyScenarioMeta"></div>
    </div>
    <div id="storyContainer" class="story-page">
      <div class="story-badge" id="storyScenarioBadge"></div>
      <div id="storyText" class="story-text"></div>
      <div id="storyPageIndex" class="story-page-index"></div>
    </div>
    <div class="btn-row">
      <button class="secondary" id="btnStoryBack">â—€ ìƒí™© ë‹¤ì‹œ ê³ ë¥´ê¸°</button>
      <button id="btnStoryNext">ë‹¤ìŒ ì¥ ë„˜ê¸°ê¸° â–¶</button>
    </div>
  </div>

  <!-- 3. ì˜· ê³ ë¥´ê¸° -->
  <div id="screen-dress" class="screen">
    <h2>3ë‹¨ê³„. ì˜·ì°¨ë¦¼ ê³¨ë¼ë³´ê¸°</h2>
    <div id="dressScenarioInfo" style="font-size:13px;color:#555;margin-bottom:6px;"></div>
    <div id="dressBadges" style="margin-bottom:6px;"></div>

    <div class="builder-grid" id="dressGrid"></div>

    <div class="summary-box">
      <div class="summary-row">
        <div class="summary-label">ì„ íƒí•œ ì˜· ê°œìˆ˜</div>
        <div class="summary-value" id="sumCount">0ê°œ</div>
      </div>
      <div class="summary-row">
        <div class="summary-label">ë”°ëœ»í•¨ í•©ê³„(ëŒ€ëµ)</div>
        <div class="summary-value" id="sumWarmth">0</div>
      </div>
      <div class="summary-row">
        <div class="summary-label">í™œë™ì„± í‰ê· (1~3)</div>
        <div class="summary-value" id="sumActivity">0</div>
      </div>
      <div class="summary-row">
        <div class="summary-label">ìœ„í—˜ ìš”ì†Œ í•©ê³„</div>
        <div class="summary-value" id="sumRisk">0</div>
      </div>
      <div class="summary-row">
        <div class="summary-label">ì˜ˆì ˆ ì ìˆ˜ í‰ê· (1~3)</div>
        <div class="summary-value" id="sumEtiquette">0</div>
      </div>
    </div>

    <div class="btn-row">
      <button class="secondary" id="btnDressBack">â—€ ì´ì•¼ê¸° ë‹¤ì‹œ ë³´ê¸°</button>
      <button id="btnEvaluate">ì ìˆ˜ & í”¼ë“œë°± ë³´ê¸° â–¶</button>
    </div>
  </div>

  <!-- 4. ê²°ê³¼ -->
  <div id="screen-result" class="screen">
    <h2>4ë‹¨ê³„. ê²°ê³¼ í™•ì¸</h2>
    <div class="result-main-score">
      ì´ì  <span id="resultScore">0</span>ì  / 100ì 
    </div>
    <div class="result-badge" id="resultBadge"></div>
    <div class="feedback-box" id="feedbackBox"></div>

    <div class="result-list">
      <strong>ğŸ“Œ ë‚´ê°€ ê³ ë¥¸ ì˜· ìš”ì•½</strong>
      <ul id="resultSummaryList"></ul>
    </div>

    <div class="btn-row">
      <button class="secondary" id="btnResultBack">â—€ ì˜· ë‹¤ì‹œ ê³ ë¥´ê¸°</button>
      <button id="btnRestart">ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸° ğŸ”</button>
    </div>
  </div>
</div>

<script>
  // --------- ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ---------
  const SCENARIOS = {
    sportsday: {
      key: "sportsday",
      name: "ë´„ ìš´ë™íšŒ ë‚ ",
      emoji: "ğŸˆ",
      shortDesc: "ìš´ë™ì¥ì—ì„œ ì‹ ë‚˜ê²Œ ë›°ëŠ” ë‚ ",
      temp: 22,
      weatherText: "ë§‘ìŒ Â· ì•½ê°„ ë”°ëœ»í•¨",
      storyPages: [
        "ì˜¤ëŠ˜ì€ ë“œë””ì–´ ê¸°ë‹¤ë¦¬ë˜ ìš´ë™íšŒ ë‚ !\nì•„ì¹¨ í–‡ì‚´ì´ êµì‹¤ ì°½ë¬¸ìœ¼ë¡œ ì‹ì•„ì§€ê³ , ìš´ë™ì¥ì—ëŠ” ì•Œë¡ë‹¬ë¡ ê¹ƒë°œì´ í„ëŸ­ì˜€ì–´ìš”.\nâ€œë°˜ ëŒ€í‘œ ê³„ì£¼ ì„ ìˆ˜ëŠ” ë°”ë¡œ ë‚˜ì•¼!â€\në„ˆëŠ” ì„¤ë ˜ ê°€ë“í•œ ë§ˆìŒìœ¼ë¡œ ì¹¨ëŒ€ì—ì„œ ë²Œë–¡ ì¼ì–´ë‚¬ì–´ìš”.",
        "ì˜·ì¥ì„ ì—´ì ì˜·ë“¤ì´ ì†ë‹¥ì†ë‹¥ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ê¸° ì‹œì‘í–ˆì–´ìš”.\nâ€œë‚˜ë¥¼ ì…ê³  ê°€! ë‚´ê°€ ì œì¼ ëˆˆì— ë„ê±°ë“ !â€ ë°˜ì§ì´ëŠ” ì˜·ì´ ë§í–ˆì–´ìš”.\nâ€œìš´ë™íšŒì—ëŠ” í™œë™í•˜ê¸° ì¢‹ì€ ì˜·ì´ ë” ì¤‘ìš”í•˜ì§€ ì•Šì„ê¹Œ?â€\níŠ¸ë ˆì´ë‹ë³µ ë°”ì§€ê°€ ì¡°ìš©íˆ ë§í–ˆì£ .",
        "ì˜¤ëŠ˜ì€ ë‹¬ë¦¬ê¸°ë„ í•˜ê³ , ì¤„ë„˜ê¸°ë„ í•˜ê³ , ì¹œêµ¬ë“¤ê³¼ ë‹¨ì²´ ê²Œì„ë„ í•´ì•¼ í•´ìš”.\në„ˆë¬´ ë¥ì§€ë„ ì¶¥ì§€ë„ ì•Šìœ¼ë©´ì„œ, ë¬´ì—‡ë³´ë‹¤ ë‹¤ì¹˜ì§€ ì•Šë„ë¡ ì•ˆì „í•œ ì˜·ì°¨ë¦¼ì„ í•´ì•¼ê² ì£ ?\nì, ì´ì œ ìš´ë™íšŒì— ê°€ì¥ ì˜ ì–´ìš¸ë¦¬ëŠ” ì˜·ì„ ì§ì ‘ ê³¨ë¼ë³¼ê¹Œìš”?"
      ],
      weights: { weather: 20, activity: 30, safety: 30, etiquette: 20 },
      idealWarmth: 1,
      warmthTolerance: 1,
      targetActivity: 2.4,
      safeRiskLow: 1,
      safeRiskMid: 3,
      minEtiquetteOk: 2.0,
      minEtiquetteGood: 2.3,
      formality: "casual"
    },
    winterTrip: {
      key: "winterTrip",
      name: "í•œê²¨ìš¸ ì•¼ì™¸ì²´í—˜í•™ìŠµ",
      emoji: "â„ï¸",
      shortDesc: "ì¶¥ì§€ë§Œ ì‹ ë‚˜ëŠ” ê²¨ìš¸ ì²´í—˜",
      temp: 0,
      weatherText: "ë§‘ìŒ Â· ë§¤ìš° ì¶”ì›€ Â· ë°”ëŒ ì¡°ê¸ˆ",
      storyPages: [
        "ì°½ë°–ì—ëŠ” í•˜ì–€ ì…ê¹€ì´ ê°€ë“.\nì˜¤ëŠ˜ì€ í•œê²¨ìš¸ ì•¼ì™¸ì²´í—˜í•™ìŠµ ë‚ ì´ì—ìš”.\në²„ìŠ¤ë¥¼ íƒ€ê³  ìˆ²ì† ì²´í—˜ì¥ì— ê°€ì„œ í•œì°¸ì„ ê±¸ìœ¼ë©° í™œë™í•´ì•¼ í•´ìš”.",
        "â€œê·¸ëƒ¥ ì˜ˆìœ ì˜· ì…ê³  ê°€ë©´ ì•ˆ ë¼?â€\në„ˆëŠ” ì ê¹ ê³ ë¯¼í–ˆì§€ë§Œ, ê³§ ì„ ìƒë‹˜ ë§ì”€ì„ ë– ì˜¬ë ¸ì–´ìš”.\nâ€œê²¨ìš¸ ì•¼ì™¸ì²´í—˜ì—ì„œëŠ” ë°œ, ì†, ê·€, ëª©ì´ ì–¼ì§€ ì•Šê²Œ ë”°ëœ»í•˜ê²Œ ì…ì–´ì•¼ í•´ìš”.â€",
        "ì˜·ì¥ ì†ì—ëŠ” ë‘êº¼ìš´ íŒ¨ë”©ê³¼ ëª©ë„ë¦¬, ì¥ê°‘, ëª¨ì, ì—¬ëŸ¬ ê°€ì§€ ë°”ì§€ê°€ ë‚˜ë€íˆ ê±¸ë ¤ ìˆì–´ìš”.\në„ˆë¬´ ê»´ì…ì–´ì„œ ì›€ì§ì´ê¸° í˜ë“¤ì–´ë„ ì•ˆ ë˜ê³ ,\nì–‡ê²Œ ì…ì–´ì„œ ëœëœ ë–¨ì–´ë„ ì•ˆ ë¼ìš”.\nì´ì œ ê²¨ìš¸ ì•¼ì™¸ì²´í—˜í•™ìŠµì— ì˜ ì–´ìš¸ë¦¬ëŠ” ì˜·ì°¨ë¦¼ì„ ê³¨ë¼ë³¼ê¹Œìš”?"
      ],
      weights: { weather: 30, activity: 15, safety: 30, etiquette: 25 },
      idealWarmth: 6,
      warmthTolerance: 2,
      targetActivity: 2.0,
      safeRiskLow: 2,
      safeRiskMid: 5,
      minEtiquetteOk: 2.0,
      minEtiquetteGood: 2.3,
      formality: "casual"
    },
    rainySchool: {
      key: "rainySchool",
      name: "ì¥ë§ˆì²  ë“±êµê¸¸",
      emoji: "ğŸŒ§ï¸",
      shortDesc: "ë¹„ ì˜¤ëŠ” ë‚  ë¯¸ë„ëŸ¬ìš´ ê¸¸",
      temp: 24,
      weatherText: "ê°•í•œ ë¹„ Â· ìŠµí•¨",
      storyPages: [
        "ì•„ì¹¨ë¶€í„° ì°½ë°–ì— ë¹—ì†Œë¦¬ê°€ ìš”ë€í•´ìš”.\nì˜¤ëŠ˜ì€ ì¥ë§ˆì² , ë¹„ê°€ í•˜ë£¨ ì¢…ì¼ ì˜¨ë‹¤ëŠ” ì˜ˆë³´ê°€ ë–´ì–´ìš”.\ní•™êµê¹Œì§€ ê°€ëŠ” ê¸¸ì—ëŠ” ë¯¸ë„ëŸ¬ìš´ ê¸¸ë„ ìˆê³ , ë¬¼ì›…ë©ì´ë„ ë§ì•„ìš”.",
        "â€œì–´ì°¨í”¼ ê¸ˆë°© í•™êµ ë„ì°©í•˜ëŠ”ë° ëŒ€ì¶© ì‹ ê³  ê°€ë„ ë˜ì§€ ì•Šì„ê¹Œ?â€\nìŠ¬ë¦¬í¼ì™€ ìš´ë™í™”, ë ˆì¸ë¶€ì¸ ê°€ ë„ˆë¥¼ ì˜¬ë ¤ë‹¤ë³´ë©° ì„œë¡œ ë¨¼ì € ë‚˜ê°€ê² ë‹¤ê³  ì•„ìš°ì„±ì…ë‹ˆë‹¤.",
        "ì˜·ì¥ì—ëŠ” ì–‡ì€ ë¹„ì˜·ê³¼ ìš°ì‚°, ê²‰ì˜·, ì—¬ëŸ¬ ê°€ì§€ ë°”ì§€ê°€ ê±¸ë ¤ ìˆì–´ìš”.\në¹„ì— í ë»‘ ì –ìœ¼ë©´ í•˜ë£¨ ì¢…ì¼ ì¶•ì¶•í•˜ê³ , ê°ê¸°ì— ê±¸ë¦´ì§€ë„ ëª°ë¼ìš”.\nì´ì œ ë¹„ ì˜¤ëŠ” ë‚  ë“±êµì— ì˜ ì–´ìš¸ë¦¬ëŠ” ì˜·ì°¨ë¦¼ì„ ê³¨ë¼ë³¼ê¹Œìš”?"
      ],
      weights: { weather: 30, activity: 10, safety: 30, etiquette: 30 },
      idealWarmth: 2,
      warmthTolerance: 1,
      targetActivity: 2.0,
      safeRiskLow: 1,
      safeRiskMid: 3,
      minEtiquetteOk: 2.0,
      minEtiquetteGood: 2.3,
      formality: "casual",
      needRainProtection: true
    },
    indoorPE: {
      key: "indoorPE",
      name: "ì‹¤ë‚´ ì²´ìœ¡ê´€ ìˆ˜ì—…",
      emoji: "ğŸ€",
      shortDesc: "ì²´ìœ¡ê´€ì—ì„œ í•˜ëŠ” ì²´ìœ¡",
      temp: 20,
      weatherText: "ì‹¤ë‚´ Â· ì ë‹¹í•œ ì˜¨ë„",
      storyPages: [
        "ì˜¤ëŠ˜ ì²´ìœ¡ ì‹œê°„ì€ ìš´ë™ì¥ì´ ì•„ë‹ˆë¼ ì‹¤ë‚´ ì²´ìœ¡ê´€ì—ì„œ í•´ìš”.\në†êµ¬, í”¼êµ¬, ì¤„ë„˜ê¸°ê¹Œì§€ ì‹ ë‚˜ê²Œ í•  ì˜ˆì •ì´ì—ìš”.",
        "ì‹¤ë‚´ ë°”ë‹¥ì€ ë¯¸ë„ëŸ¬ìš¸ ìˆ˜ë„ ìˆê³ ,\nì¹œêµ¬ë“¤ê³¼ ë¶€ë”ªí ìˆ˜ë„ ìˆì–´ìš”.\në„ˆë¬´ ì¥ì‹ì´ ë§ê±°ë‚˜ ê¸´ ëˆì´ ìˆëŠ” ì˜·ì€ ìœ„í—˜í• ì§€ë„ ëª°ë¼ìš”.",
        "ì‹¤ë‚´ì—ì„œ ì˜ˆì ˆì„ ì§€í‚¤ë©´ì„œë„\në§ˆìŒê» ë›¸ ìˆ˜ ìˆëŠ” ì˜·ì°¨ë¦¼ì´ í•„ìš”í•´ìš”.\nì´ì œ ì²´ìœ¡ê´€ ìˆ˜ì—…ì— ì•Œë§ì€ ì˜·ì°¨ë¦¼ì„ ê³¨ë¼ë³¼ê¹Œìš”?"
      ],
      weights: { weather: 10, activity: 35, safety: 35, etiquette: 20 },
      idealWarmth: 1,
      warmthTolerance: 1,
      targetActivity: 2.5,
      safeRiskLow: 1,
      safeRiskMid: 3,
      minEtiquetteOk: 2.0,
      minEtiquetteGood: 2.3,
      formality: "casual"
    },
    familyMeal: {
      key: "familyMeal",
      name: "ê°€ì¡± ëª¨ì„ Â· ì™¸ì‹",
      emoji: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§",
      shortDesc: "ì‹ë‹¹ì—ì„œ í•˜ëŠ” ê°€ì¡± ëª¨ì„",
      temp: 18,
      weatherText: "ì‹¤ë‚´ Â· ì¡°ê¸ˆ ìŒ€ìŒ€í•œ ë‚ ",
      storyPages: [
        "ì˜¤ëŠ˜ ì €ë…ì€ ì˜¤ëœë§Œì— ê°€ì¡±ë“¤ì´ ëª¨ë‘ ëª¨ì´ëŠ” ë‚ ì´ì—ìš”.\ní• ë¨¸ë‹ˆ, í• ì•„ë²„ì§€ë„ ì˜¤ì‹œê³ , ì‚¬ì§„ë„ ë§ì´ ì°ì„ ì˜ˆì •ì´ì—ìš”.",
        "ì§‘ì—ì„œ ì…ëŠ” ì ì˜·ì´ë‚˜ ëŠ˜ì–´ì§„ í‹°ì…”ì¸ ë¥¼ ê·¸ëŒ€ë¡œ ì…ê³  ê°€ë©´\nì¡°ê¸ˆ ì‹¤ë¡€ì¼ì§€ë„ ëª°ë¼ìš”.\nê·¸ë ‡ë‹¤ê³  ë„ˆë¬´ ë¶ˆí¸í•œ ì˜·ì„ ì…ìœ¼ë©´ ë°¥ ë¨¹ì„ ë•Œ í˜ë“¤ê² ì£ ?",
        "í¸ì•ˆí•˜ë©´ì„œë„ ë‹¨ì •í•œ ì˜·,\nê°€ì¡±ì„ ì¡´ì¤‘í•˜ëŠ” ë§ˆìŒì„ ë³´ì—¬ ì¤„ ìˆ˜ ìˆëŠ” ì˜·ì°¨ë¦¼ì´ë¼ë©´ ë” ì¢‹ê² ì£ .\nì´ì œ ê°€ì¡± ëª¨ì„ì— ì–´ìš¸ë¦¬ëŠ” ì˜·ì„ ê³¨ë¼ë³¼ê¹Œìš”?"
      ],
      weights: { weather: 10, activity: 10, safety: 10, etiquette: 70 },
      idealWarmth: 1,
      warmthTolerance: 2,
      targetActivity: 1.8,
      safeRiskLow: 2,
      safeRiskMid: 4,
      minEtiquetteOk: 2.1,
      minEtiquetteGood: 2.5,
      formality: "formal"
    },
    schoolEvent: {
      key: "schoolEvent",
      name: "í•™êµ ë°œí‘œíšŒ Â· í•™ì˜ˆíšŒ",
      emoji: "ğŸ¤",
      shortDesc: "ì¹œêµ¬Â·í•™ë¶€ëª¨ ì•ì—ì„œ ë°œí‘œí•˜ëŠ” ë‚ ",
      temp: 19,
      weatherText: "ì‹¤ë‚´ Â· ì•½ê°„ ì„ ì„ í•¨",
      storyPages: [
        "ì˜¤ëŠ˜ì€ í•™êµì—ì„œ ë°œí‘œíšŒì™€ í•™ì˜ˆíšŒê°€ ì—´ë¦¬ëŠ” ë‚ ì´ì—ìš”.\nì¹œêµ¬ë“¤, ì„ ìƒë‹˜, í•™ë¶€ëª¨ë‹˜ë“¤ì´ ëª¨ë‘ ëª¨ì´ëŠ” íŠ¹ë³„í•œ ë‚ ì´ì£ .",
        "ë„ˆëŠ” ë¬´ëŒ€ì— ì„œì„œ ë°œí‘œë¥¼ í•˜ê±°ë‚˜\nì¹œêµ¬ë“¤ì´ ì¤€ë¹„í•œ ê³µì—°ì„ ê´€ëŒí•  ìˆ˜ë„ ìˆì–´ìš”.\në„ˆë¬´ ëˆˆì— ë„ëŠ” ì˜·ì´ë‚˜ ì¥ë‚œìŠ¤ëŸ¬ìš´ ë¬¸êµ¬ê°€ ì íŒ ì˜·ì€\ní–‰ì‚¬ ë¶„ìœ„ê¸°ë¥¼ íë¦´ ìˆ˜ë„ ìˆì–´ìš”.",
        "ë‹¨ì •í•˜ë©´ì„œë„ ë‚˜ë‹¤ìš´ ëª¨ìŠµì„ ë³´ì—¬ ì¤„ ìˆ˜ ìˆëŠ” ì˜·.\në„ˆë¬´ ë¶ˆí¸í•˜ì§€ ì•Šìœ¼ë©´ì„œë„ ì˜ˆì˜ ìˆëŠ” ì˜·ì°¨ë¦¼.\nì´ì œ í•™êµ ë°œí‘œíšŒì— ì•Œë§ì€ ì˜·ì„ ê³¨ë¼ë³¼ê¹Œìš”?"
      ],
      weights: { weather: 10, activity: 20, safety: 10, etiquette: 60 },
      idealWarmth: 1,
      warmthTolerance: 2,
      targetActivity: 2.0,
      safeRiskLow: 2,
      safeRiskMid: 4,
      minEtiquetteOk: 2.3,
      minEtiquetteGood: 2.6,
      formality: "formal"
    },
    waterPlay: {
      key: "waterPlay",
      name: "ì—¬ë¦„ ë¬¼ë†€ì´í„°",
      emoji: "ğŸ–ï¸",
      shortDesc: "ì‹œì›í•œ ë¬¼ë†€ì´í•˜ëŠ” ë‚ ",
      temp: 30,
      weatherText: "ë¬´ë”ìœ„ Â· í–‡ë¹› ê°•í•¨",
      storyPages: [
        "ì˜¤ëŠ˜ì€ ì¹œêµ¬ë“¤ê³¼ ë¬¼ë†€ì´í„°ì— ê°€ëŠ” ë‚ ì´ì—ìš”.\nì‹œì›í•œ ë¬¼ì¤„ê¸°ì™€ ë¶„ìˆ˜, ë¯¸ë„ëŸ¼í‹€ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”.",
        "ë¬¼ì— ì –ì–´ë„ ê´œì°®ì€ ì˜·ì¸ì§€,\nìì™¸ì„ ì—ì„œ í”¼ë¶€ë¥¼ ë³´í˜¸í•´ ì¤„ ìˆ˜ ìˆëŠ”ì§€,\në¯¸ë„ëŸ¬ì§€ì§€ ì•ŠëŠ” ì‹ ë°œì¸ì§€ê°€ ì¤‘ìš”í•´ìš”.",
        "ë„ˆë¬´ ë…¸ì¶œì´ ì‹¬í•œ ì˜·ì´ë‚˜, ë¯¸ë„ëŸ¬ìš´ ìŠ¬ë¦¬í¼ëŠ” ìœ„í—˜í•  ìˆ˜ ìˆì–´ìš”.\nì´ì œ ì•ˆì „í•˜ê³  ê±´ê°•í•˜ê²Œ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ë¬¼ë†€ì´ ì˜·ì°¨ë¦¼ì„ ê³¨ë¼ë³¼ê¹Œìš”?"
      ],
      weights: { weather: 15, activity: 25, safety: 40, etiquette: 20 },
      idealWarmth: 0,
      warmthTolerance: 1,
      targetActivity: 2.4,
      safeRiskLow: 1,
      safeRiskMid: 3,
      minEtiquetteOk: 2.0,
      minEtiquetteGood: 2.3,
      formality: "casual",
      needRainProtection: true
    },
    museum: {
      key: "museum",
      name: "ë„ì„œê´€ Â· ë°•ë¬¼ê´€ ê²¬í•™",
      emoji: "ğŸ›ï¸",
      shortDesc: "ì¡°ìš©í•œ ê³µê°„ì—ì„œì˜ ê²¬í•™",
      temp: 20,
      weatherText: "ì‹¤ë‚´ Â· ì¾Œì í•¨",
      storyPages: [
        "ì˜¤ëŠ˜ì€ ë„ì„œê´€ê³¼ ë°•ë¬¼ê´€ìœ¼ë¡œ ê²¬í•™ì„ ê°€ëŠ” ë‚ ì´ì—ìš”.\nì¡°ìš©íˆ ì±…ì„ ë³´ê³ , ì „ì‹œë¬¼ì„ ê´€ëŒí•´ì•¼ í•˜ëŠ” ê³µê°„ì´ì£ .",
        "ë„ˆë¬´ ìš”ë€í•œ ì†Œë¦¬ê°€ ë‚˜ëŠ” ì˜·ì´ë‚˜ ì•¡ì„¸ì„œë¦¬ëŠ”\në‹¤ë¥¸ ì‚¬ëŒë“¤ì—ê²Œ ë°©í•´ê°€ ë  ìˆ˜ ìˆì–´ìš”.\nì•‰ì•„ì„œ ì˜¤ë˜ êµ¬ê²½í•´ì•¼ í•˜ë‹ˆ, ë„ˆë¬´ ë¶ˆí¸í•œ ì˜·ë„ ì¢‹ì§€ ì•Šê² ì£ ?",
        "í¸ì•ˆí•˜ë©´ì„œë„ ë‹¨ì •í•œ ì˜·ì°¨ë¦¼,\nì¡°ìš©í•œ ë¶„ìœ„ê¸°ë¥¼ í•¨ê»˜ ì§€í‚¬ ìˆ˜ ìˆëŠ” ì˜·ì„ ê³¨ë¼ë³´ì„¸ìš”.\nì´ì œ ë„ì„œê´€Â·ë°•ë¬¼ê´€ ê²¬í•™ì— ì•Œë§ì€ ì˜·ì°¨ë¦¼ì„ ë§Œë“¤ì–´ë³¼ê¹Œìš”?"
      ],
      weights: { weather: 10, activity: 10, safety: 20, etiquette: 60 },
      idealWarmth: 1,
      warmthTolerance: 2,
      targetActivity: 1.8,
      safeRiskLow: 2,
      safeRiskMid: 4,
      minEtiquetteOk: 2.2,
      minEtiquetteGood: 2.5,
      formality: "formal"
    }
  };

  // --------- ì˜· ë°ì´í„° (ì¹´í…Œê³ ë¦¬ë³„, ì‹œë‚˜ë¦¬ì˜¤ë³„ ë…¸ì¶œ ë‹¤ë¥´ê²Œ) ----------
  const CLOTHES = {
    top: [
      {
        id: "tshirt_short",
        name: "ë©´ ë°˜íŒ” í‹°ì…”ì¸ ",
        warmth: 0,
        activity: 3,
        risk: 0,
        etiquette: 3,
        tags: ["ìš´ë™ë³µ", "ìºì£¼ì–¼"],
        scenarios: ["sportsday", "indoorPE", "rainySchool", "waterPlay", "museum"]
      },
      {
        id: "tshirt_long",
        name: "ë©´ ê¸´íŒ” í‹°ì…”ì¸ ",
        warmth: 1,
        activity: 2,
        risk: 0,
        etiquette: 3,
        tags: ["ìºì£¼ì–¼"],
        scenarios: ["sportsday", "indoorPE", "rainySchool", "winterTrip", "museum"]
      },
      {
        id: "blouse_fancy",
        name: "í”„ë¦´ ë¸”ë¼ìš°ìŠ¤",
        warmth: 0,
        activity: 1,
        risk: 1,
        etiquette: 2,
        tags: ["ì¥ì‹ë§ìŒ", "ì¡°ê¸ˆê²©ì‹"],
        scenarios: ["familyMeal", "schoolEvent", "museum"]
      },
      {
        id: "hoodie",
        name: "í›„ë“œí‹°",
        warmth: 1,
        activity: 2,
        risk: 1,
        etiquette: 2,
        tags: ["í›„ë“œëˆ", "ìºì£¼ì–¼"],
        scenarios: ["sportsday", "rainySchool", "winterTrip", "indoorPE"]
      },
      {
        id: "crop_sleeveless",
        name: "ë¯¼ì†Œë§¤ í¬ë¡­í‹°",
        warmth: -1,
        activity: 2,
        risk: 0,
        etiquette: 1,
        tags: ["ë…¸ì¶œë†’ìŒ", "ìºì£¼ì–¼"],
        scenarios: ["sportsday", "waterPlay"]
      },
      {
        id: "rashguard_top",
        name: "ë˜ì‹œê°€ë“œ ìƒì˜",
        warmth: 0,
        activity: 3,
        risk: 0,
        etiquette: 2,
        tags: ["ë¬¼ë†€ì´", "ìì™¸ì„ ì°¨ë‹¨"],
        scenarios: ["waterPlay"]
      },
      {
        id: "shirt_vest",
        name: "ì…”ì¸  + ì¡°ë¼",
        warmth: 1,
        activity: 2,
        risk: 0,
        etiquette: 3,
        tags: ["ê²©ì‹"],
        scenarios: ["familyMeal", "schoolEvent", "museum"]
      },
      {
        id: "knit_sweater",
        name: "ë‹ˆíŠ¸ ìŠ¤ì›¨í„°",
        warmth: 2,
        activity: 1,
        risk: 0,
        etiquette: 3,
        tags: ["ê²¨ìš¸", "ë‹¨ì •"],
        scenarios: ["winterTrip", "familyMeal", "museum"]
      }
    ],
    bottom: [
      {
        id: "jogger_pants",
        name: "íŠ¸ë ˆì´ë‹ ë°”ì§€",
        warmth: 0,
        activity: 3,
        risk: 0,
        etiquette: 3,
        tags: ["ìš´ë™ë³µ"],
        scenarios: ["sportsday", "indoorPE", "rainySchool", "winterTrip", "waterPlay"]
      },
      {
        id: "cotton_pants",
        name: "ë©´ ë°”ì§€",
        warmth: 1,
        activity: 2,
        risk: 0,
        etiquette: 3,
        tags: ["ë‹¨ì •"],
        scenarios: ["familyMeal", "schoolEvent", "museum", "rainySchool"]
      },
      {
        id: "jeans_skinny",
        name: "ìŠ¤í‚¤ë‹ˆ ì²­ë°”ì§€",
        warmth: 1,
        activity: 1,
        risk: 0,
        etiquette: 2,
        tags: ["ìºì£¼ì–¼"],
        scenarios: ["sportsday", "rainySchool", "museum", "familyMeal"]
      },
      {
        id: "shorts_sports",
        name: "ìš´ë™ìš© ë°˜ë°”ì§€",
        warmth: -1,
        activity: 3,
        risk: 0,
        etiquette: 2,
        tags: ["ìš´ë™ë³µ"],
        scenarios: ["sportsday", "indoorPE", "waterPlay"]
      },
      {
        id: "skirt_short",
        name: "ì§§ì€ ì¹˜ë§ˆ",
        warmth: -1,
        activity: 1,
        risk: 1,
        etiquette: 2,
        tags: ["ë…¸ì¶œë†’ìŒ", "ì¥ì‹ë§ìŒ"],
        scenarios: ["familyMeal", "schoolEvent"]
      },
      {
        id: "swim_shorts",
        name: "ë¬¼ë†€ì´ ë°˜ë°”ì§€",
        warmth: -1,
        activity: 3,
        risk: 0,
        etiquette: 2,
        tags: ["ë¬¼ë†€ì´"],
        scenarios: ["waterPlay"]
      },
      {
        id: "slacks",
        name: "ê¹”ë”í•œ ìŠ¬ë™ìŠ¤",
        warmth: 1,
        activity: 2,
        risk: 0,
        etiquette: 3,
        tags: ["ê²©ì‹"],
        scenarios: ["familyMeal", "schoolEvent", "museum"]
      }
    ],
    outer: [
      {
        id: "no_outer",
        name: "ê²‰ì˜· ì…ì§€ ì•Šê¸°",
        warmth: 0,
        activity: 3,
        risk: 0,
        etiquette: 3,
        tags: [],
        scenarios: ["sportsday", "indoorPE", "familyMeal", "schoolEvent", "waterPlay", "museum", "rainySchool"]
      },
      {
        id: "cardigan_light",
        name: "ì–‡ì€ ê°€ë””ê±´",
        warmth: 1,
        activity: 2,
        risk: 0,
        etiquette: 3,
        tags: ["ë‹¨ì •"],
        scenarios: ["familyMeal", "schoolEvent", "museum", "rainySchool"]
      },
      {
        id: "padded_jacket",
        name: "ë‘êº¼ìš´ íŒ¨ë”© ì í¼",
        warmth: 3,
        activity: 1,
        risk: 0,
        etiquette: 3,
        tags: ["ê²¨ìš¸ìš©"],
        scenarios: ["winterTrip"]
      },
      {
        id: "raincoat",
        name: "ìš°ë¹„",
        warmth: 1,
        activity: 2,
        risk: 0,
        etiquette: 3,
        rain: 2,
        tags: ["ë¹„ì˜·", "ë°©ìˆ˜"],
        scenarios: ["rainySchool", "waterPlay"]
      },
      {
        id: "coat_formal",
        name: "ì½”íŠ¸",
        warmth: 2,
        activity: 1,
        risk: 0,
        etiquette: 3,
        tags: ["ê²©ì‹"],
        scenarios: ["familyMeal", "schoolEvent", "museum", "winterTrip"]
      },
      {
        id: "windbreaker",
        name: "ì–‡ì€ ë°”ëŒë§‰ì´ ì í¼",
        warmth: 1,
        activity: 3,
        risk: 0,
        etiquette: 3,
        tags: ["ìš´ë™ë³µ"],
        scenarios: ["sportsday", "indoorPE", "rainySchool", "waterPlay"]
      }
    ],
    shoes: [
      {
        id: "sneakers",
        name: "ìš´ë™í™”",
        warmth: 0,
        activity: 3,
        risk: 0,
        etiquette: 3,
        rain: 0,
        tags: ["ìš´ë™ë³µ", "ì•ˆì •"],
        scenarios: ["sportsday", "indoorPE", "rainySchool", "winterTrip", "museum", "familyMeal"]
      },
      {
        id: "slippers",
        name: "ìŠ¬ë¦¬í¼",
        warmth: -1,
        activity: 1,
        risk: 3,
        etiquette: 1,
        rain: 0,
        tags: ["ìœ„í—˜", "ìºì£¼ì–¼"],
        scenarios: ["waterPlay", "rainySchool"]
      },
      {
        id: "dress_shoes",
        name: "êµ¬ë‘",
        warmth: 0,
        activity: 1,
        risk: 2,
        etiquette: 3,
        rain: 0,
        tags: ["ê²©ì‹"],
        scenarios: ["familyMeal", "schoolEvent", "museum"]
      },
      {
        id: "rain_boots",
        name: "ë ˆì¸ë¶€ì¸ ",
        warmth: 1,
        activity: 2,
        risk: 0,
        etiquette: 3,
        rain: 2,
        tags: ["ë°©ìˆ˜"],
        scenarios: ["rainySchool", "waterPlay", "winterTrip"]
      },
      {
        id: "indoor_slippers",
        name: "ì‹¤ë‚´í™”",
        warmth: 0,
        activity: 2,
        risk: 1,
        etiquette: 3,
        tags: ["ì‹¤ë‚´ìš©"],
        scenarios: ["indoorPE", "museum"]
      },
      {
        id: "water_sandals",
        name: "ë¬¼ë†€ì´ ìƒŒë“¤",
        warmth: -1,
        activity: 2,
        risk: 1,
        etiquette: 2,
        rain: 2,
        tags: ["ë¬¼ë†€ì´", "ë°©ìˆ˜"],
        scenarios: ["waterPlay"]
      },
      {
        id: "winter_boots",
        name: "í„¸ë¶€ì¸ ",
        warmth: 2,
        activity: 1,
        risk: 1,
        etiquette: 3,
        rain: 1,
        tags: ["ê²¨ìš¸"],
        scenarios: ["winterTrip"]
      }
    ],
    accessory: [
      {
        id: "no_acc",
        name: "ì•¡ì„¸ì„œë¦¬ ì•ˆ í•˜ê¸°",
        warmth: 0,
        activity: 3,
        risk: 0,
        etiquette: 3,
        tags: [],
        scenarios: ["sportsday", "indoorPE", "rainySchool", "winterTrip", "familyMeal", "schoolEvent", "waterPlay", "museum"]
      },
      {
        id: "cap_hat",
        name: "ìº¡ ëª¨ì",
        warmth: 0,
        activity: 3,
        risk: 0,
        etiquette: 3,
        tags: ["í–‡ë¹›ì°¨ë‹¨"],
        scenarios: ["sportsday", "indoorPE", "waterPlay", "rainySchool"]
      },
      {
        id: "scarf_long",
        name: "ê¸´ ëª©ë„ë¦¬",
        warmth: 1,
        activity: 2,
        risk: 1,
        etiquette: 3,
        tags: ["ê¸´ëˆ", "ê²¨ìš¸"],
        scenarios: ["winterTrip"]
      },
      {
        id: "big_earring",
        name: "í° ë§ ê·€ê±¸ì´",
        warmth: 0,
        activity: 3,
        risk: 2,
        etiquette: 1,
        tags: ["ì¥ì‹ë§ìŒ"],
        scenarios: ["familyMeal", "schoolEvent"]
      },
      {
        id: "backpack",
        name: "ë°±íŒ©",
        warmth: 0,
        activity: 2,
        risk: 0,
        etiquette: 3,
        tags: ["ì‹¤ìš©ì "],
        scenarios: ["sportsday", "rainySchool", "winterTrip", "indoorPE", "museum"]
      },
      {
        id: "crossbag_small",
        name: "ì‘ì€ í¬ë¡œìŠ¤ë°±",
        warmth: 0,
        activity: 2,
        risk: 1,
        etiquette: 3,
        tags: ["ì‹¤ìš©ì "],
        scenarios: ["familyMeal", "schoolEvent", "museum"]
      },
      {
        id: "rain_hat",
        name: "ë°©ìˆ˜ ëª¨ì",
        warmth: 0,
        activity: 3,
        risk: 0,
        etiquette: 3,
        tags: ["ë°©ìˆ˜"],
        scenarios: ["rainySchool", "waterPlay"]
      },
      {
        id: "winter_gloves",
        name: "ë²™ì–´ë¦¬ ì¥ê°‘",
        warmth: 1,
        activity: 2,
        risk: 0,
        etiquette: 3,
        tags: ["ê²¨ìš¸"],
        scenarios: ["winterTrip"]
      }
    ]
  };

  function normalizeItem(item) {
    return {
      rain: 0,
      ...item
    };
  }
  Object.keys(CLOTHES).forEach(cat => {
    CLOTHES[cat] = CLOTHES[cat].map(normalizeItem);
  });

  // --------- ìƒíƒœ ---------
  let currentScenarioKey = null;
  let currentStoryIndex = 0;

  function showScreen(id) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  // --------- ì‹œë‚˜ë¦¬ì˜¤ ë Œë”ë§ ---------
  function renderScenarioCards() {
    const grid = document.getElementById("scenarioGrid");
    grid.innerHTML = "";
    Object.values(SCENARIOS).forEach(sc => {
      const card = document.createElement("div");
      card.className = "scenario-card";
      card.dataset.key = sc.key;
      card.innerHTML = `
        <div class="scenario-title">
          <span class="scenario-emoji">${sc.emoji}</span>${sc.name}
        </div>
        <div class="scenario-desc">${sc.shortDesc}</div>
        <div class="scenario-meta">
          ê¸°ì˜¨ ì•½ ${sc.temp}â„ƒ Â· ${sc.weatherText}
        </div>
      `;
      card.addEventListener("click", () => {
        document.querySelectorAll(".scenario-card").forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");
        currentScenarioKey = sc.key;
        document.getElementById("btnScenarioNext").disabled = false;
      });
      grid.appendChild(card);
    });
  }

  // --------- ìŠ¤í† ë¦¬ ë Œë”ë§ ---------
  function renderStory() {
    const sc = SCENARIOS[currentScenarioKey];
    const pages = sc.storyPages;
    const textEl = document.getElementById("storyText");
    const idxEl = document.getElementById("storyPageIndex");
    const badgeEl = document.getElementById("storyScenarioBadge");

    document.getElementById("storyScenarioTitle").textContent =
      `${sc.emoji} ${sc.name}`;
    document.getElementById("storyScenarioMeta").textContent =
      `ê¸°ì˜¨ ì•½ ${sc.temp}â„ƒ Â· ${sc.weatherText}`;

    badgeEl.textContent = sc.name;
    textEl.textContent = pages[currentStoryIndex] || "";
    idxEl.textContent = `${currentStoryIndex + 1} / ${pages.length} ì¥`;

    const btnNext = document.getElementById("btnStoryNext");
    btnNext.textContent = currentStoryIndex === pages.length - 1
      ? "ì˜· ê³ ë¥´ëŸ¬ ê°€ê¸° â–¶"
      : "ë‹¤ìŒ ì¥ ë„˜ê¸°ê¸° â–¶";
  }

  // --------- ì„ íƒí•œ ì˜· ê°€ì ¸ì˜¤ê¸° ---------
  function getSelectedItems() {
    const cats = ["top", "bottom", "outer", "shoes", "accessory"];
    const selected = [];
    cats.forEach(cat => {
      const checked = document.querySelector(`input[name="sel_${cat}"]:checked`);
      if (checked && checked.value !== "") {
        const info = JSON.parse(checked.dataset.info);
        selected.push(info);
      }
    });
    return selected;
  }

  function updateDressSummary() {
    const items = getSelectedItems();
    const count = items.length;
    let warmthSum = 0;
    let actSum = 0;
    let riskSum = 0;
    let etiquetteSum = 0;

    items.forEach(it => {
      warmthSum += it.warmth || 0;
      actSum += it.activity || 0;
      riskSum += it.risk || 0;
      etiquetteSum += it.etiquette || 0;
    });

    const actAvg = count ? (actSum / count) : 0;
    const etiAvg = count ? (etiquetteSum / count) : 0;

    document.getElementById("sumCount").textContent = `${count}ê°œ`;
    document.getElementById("sumWarmth").textContent = warmthSum.toFixed(1);
    document.getElementById("sumActivity").textContent = actAvg.toFixed(2);
    document.getElementById("sumRisk").textContent = riskSum.toFixed(1);
    document.getElementById("sumEtiquette").textContent = etiAvg.toFixed(2);
  }

  // --------- ì˜· ê³ ë¥´ê¸° í™”ë©´ ë Œë”ë§ ---------
  function renderDressScreen() {
    const sc = SCENARIOS[currentScenarioKey];
    document.getElementById("dressScenarioInfo").textContent =
      `${sc.emoji} ${sc.name} ìƒí™©ì— ì–´ìš¸ë¦¬ëŠ” ìƒì˜, í•˜ì˜, ê²‰ì˜·, ì‹ ë°œ, ì•¡ì„¸ì„œë¦¬ë¥¼ ê³¨ë¼ë³´ì„¸ìš”.`;

    const badges = document.getElementById("dressBadges");
    badges.innerHTML = "";
    const b1 = document.createElement("span");
    b1.className = "badge";
    b1.textContent = `ê¸°ì˜¨: ì•½ ${sc.temp}â„ƒ (${sc.weatherText})`;
    const b2 = document.createElement("span");
    b2.className = "badge";
    b2.textContent = `ì¤‘ìš”í•œ ìš”ì†Œ: ${
      sc.formality === "formal" ? "ì˜ˆì ˆÂ·ë‹¨ì •í•¨, ìƒí™©ì— ë§ëŠ” ì˜·" :
      sc.key === "sportsday" || sc.key === "indoorPE" ? "í™œë™ì„±Â·ì•ˆì „" :
      sc.key === "winterTrip" ? "ë³´ì˜¨Â·ì•ˆì „" :
      sc.key === "rainySchool" || sc.key === "waterPlay" ? "ë°©ìˆ˜Â·ì•ˆì „" :
      "í¸ì•ˆí•¨ê³¼ ì˜ˆì ˆ"
    }`;
    badges.appendChild(b1);
    badges.appendChild(b2);

    const grid = document.getElementById("dressGrid");
    grid.innerHTML = "";

    const groups = [
      { key: "top", label: "ìƒì˜", subtitle: "ìœ—ì˜·ì„ í•œ ê°€ì§€ ê³ ë¥´ì„¸ìš”." },
      { key: "bottom", label: "í•˜ì˜", subtitle: "ë°”ì§€ë‚˜ ì¹˜ë§ˆë¥¼ í•œ ê°€ì§€ ê³ ë¥´ì„¸ìš”." },
      { key: "outer", label: "ê²‰ì˜·", subtitle: "ê²‰ì˜·ì´ í•„ìš” ì—†ë‹¤ë©´ 'ê²‰ì˜· ì…ì§€ ì•Šê¸°'ë¥¼ ê³ ë¥´ì„¸ìš”." },
      { key: "shoes", label: "ì‹ ë°œ", subtitle: "ì‹ ë°œì€ ê¼­ í•œ ê°€ì§€ ê³¨ë¼ì•¼ í•´ìš”." },
      { key: "accessory", label: "ì•¡ì„¸ì„œë¦¬/ê°€ë°©", subtitle: "ê¼­ í•„ìš”í•˜ì§€ ì•Šë‹¤ë©´ 'ì•¡ì„¸ì„œë¦¬ ì•ˆ í•˜ê¸°'ë¥¼ ê³¨ë¼ë„ ì¢‹ì•„ìš”." }
    ];

    groups.forEach(group => {
      const box = document.createElement("div");
      box.className = "group-card";
      box.innerHTML = `
        <div class="group-title">${group.label}</div>
        <div class="group-subtitle">${group.subtitle}</div>
      `;

      let items = CLOTHES[group.key] || [];
      // ì‹œë‚˜ë¦¬ì˜¤ë³„ë¡œ ë…¸ì¶œí•  ì˜· í•„í„°ë§
      items = items.filter(it => {
        if (it.scenarios && !it.scenarios.includes(sc.key)) return false;
        return true;
      });

      items.forEach(item => {
        const option = document.createElement("label");
        option.className = "item-option";

        const input = document.createElement("input");
        input.type = "radio";
        input.name = `sel_${group.key}`;
        input.value = item.id;
        input.dataset.info = JSON.stringify({ category: group.key, ...item });
        input.addEventListener("change", updateDressSummary);

        // ê¸°ë³¸ ì„ íƒê°’: no_outer, no_acc
        if (item.id === "no_outer" || item.id === "no_acc") {
          input.checked = true;
        }

        const infoDiv = document.createElement("div");
        infoDiv.innerHTML = `
          <div class="item-main">${item.name}</div>
          <div class="item-meta">
            ë”°ëœ»í•¨: ${item.warmth ?? 0}, í™œë™ì„±: ${item.activity ?? 0}, ìœ„í—˜ë„: ${item.risk ?? 0}, ì˜ˆì ˆ: ${item.etiquette ?? 0}
            ${item.tags && item.tags.length ? "<br>íŠ¹ì§•: " + item.tags.join(", ") : ""}
          </div>
        `;

        option.appendChild(input);
        option.appendChild(infoDiv);
        box.appendChild(option);
      });

      grid.appendChild(box);
    });

    updateDressSummary();
  }

  // --------- í‰ê°€ í•¨ìˆ˜ ---------
  function evaluateOutfit() {
    const sc = SCENARIOS[currentScenarioKey];
    const items = getSelectedItems();
    const cats = ["top", "bottom", "shoes"];
    let missingRequired = [];
    cats.forEach(cat => {
      const hasCat = items.some(it => it.category === cat);
      if (!hasCat) missingRequired.push(cat);
    });

    let warmthSum = 0;
    let actSum = 0;
    let riskSum = 0;
    let etiquetteSum = 0;
    let rainScoreFlag = false;

    items.forEach(it => {
      warmthSum += it.warmth || 0;
      actSum += it.activity || 0;
      riskSum += it.risk || 0;
      etiquetteSum += it.etiquette || 0;
      if (it.rain && it.rain > 0) rainScoreFlag = true;
    });

    const count = items.length || 1;
    const actAvg = actSum / count;
    const etiAvg = etiquetteSum / count;

    // 1) ë‚ ì”¨/ë³´ì˜¨ ì ìˆ˜
    let weatherScore = 0;
    const wWeight = sc.weights.weather || 0;
    const diff = Math.abs(warmthSum - sc.idealWarmth);
    if (diff <= sc.warmthTolerance) {
      weatherScore = wWeight;
    } else if (diff <= sc.warmthTolerance + 1) {
      weatherScore = Math.round(wWeight * 0.6);
    } else {
      weatherScore = Math.round(wWeight * 0.3);
    }

    // ë¹„/ë¬¼ë†€ì´ ìƒí™©ì—ì„œ ë°©ìˆ˜ ì¥ë¹„ ì—†ìœ¼ë©´ ê°ì 
    if ((sc.key === "rainySchool" || sc.key === "waterPlay") && !rainScoreFlag) {
      weatherScore = Math.round(weatherScore * 0.5);
    }

    // 2) í™œë™ì„± ì ìˆ˜
    let activityScore = 0;
    const aWeight = sc.weights.activity || 0;
    if (actAvg >= sc.targetActivity + 0.2) {
      activityScore = aWeight;
    } else if (actAvg >= sc.targetActivity - 0.3) {
      activityScore = Math.round(aWeight * 0.7);
    } else {
      activityScore = Math.round(aWeight * 0.3);
    }

    // 3) ì•ˆì „ ì ìˆ˜ (ì™„í™” ë²„ì „)
    let safetyScore = 0;
    const sWeight = sc.weights.safety || 0;
    if (riskSum <= sc.safeRiskLow) {
      safetyScore = sWeight;
    } else if (riskSum <= sc.safeRiskMid) {
      safetyScore = Math.round(sWeight * 0.8);
    } else {
      safetyScore = Math.round(sWeight * 0.4);
    }

    // 4) ì˜ˆì ˆÂ·TPO ì ìˆ˜
    let etiquetteScore = 0;
    const eWeight = sc.weights.etiquette || 0;
    if (etiAvg >= sc.minEtiquetteGood) {
      etiquetteScore = eWeight;
    } else if (etiAvg >= sc.minEtiquetteOk) {
      etiquetteScore = Math.round(eWeight * 0.7);
    } else {
      etiquetteScore = Math.round(eWeight * 0.3);
    }

    let totalScore = weatherScore + activityScore + safetyScore + etiquetteScore;
    if (missingRequired.length > 0) {
      totalScore = Math.max(0, totalScore - 10 * missingRequired.length);
    }
    if (totalScore > 100) totalScore = 100;

    const feedbackLines = [];
    const goodLines = [];
    const badLines = [];

    if (weatherScore >= (sc.weights.weather || 0) * 0.8) {
      goodLines.push("Â· ê¸°ì˜¨ê³¼ ë‚ ì”¨ì— ì–´ìš¸ë¦¬ëŠ” ì˜·ì„ ì˜ ê³¨ëì–´ìš”.");
    }
    if (activityScore >= (sc.weights.activity || 0) * 0.8) {
      goodLines.push("Â· ì›€ì§ì´ê¸° í¸í•œ ì˜·ì„ ì„ íƒí•´ì„œ í™œë™í•˜ê¸° ì¢‹ì•„ìš”.");
    }
    if (safetyScore >= (sc.weights.safety || 0) * 0.8) {
      goodLines.push("Â· ì¥ì‹ì´ë‚˜ ìœ„í—˜í•œ ìš”ì†Œê°€ ì ì–´ì„œ ë¹„êµì  ì•ˆì „í•œ ì˜·ì°¨ë¦¼ì´ì—ìš”.");
    }
    if (etiquetteScore >= (sc.weights.etiquette || 0) * 0.8) {
      goodLines.push("Â· ì´ ìƒí™©ì— ì–´ìš¸ë¦¬ëŠ” ë‹¨ì •í•œ ì˜·ì°¨ë¦¼ì„ ì˜ ì„ íƒí–ˆì–´ìš”.");
    }

    if (weatherScore <= (sc.weights.weather || 0) * 0.4) {
      if (warmthSum < sc.idealWarmth - sc.warmthTolerance) {
        badLines.push("Â· ì „ì²´ì ìœ¼ë¡œ ë„ˆë¬´ ì–‡ê²Œ ì…ì–´ì„œ ì¶”ìš¸ ìˆ˜ ìˆì–´ìš”. ì˜·ì„ í•œ ê²¹ ë” ì…ê±°ë‚˜ ë” ë”°ëœ»í•œ ì˜·ì„ ê³¨ë¼ë³´ì„¸ìš”.");
      } else {
        badLines.push("Â· ë„ˆë¬´ ë‘ê»ê²Œ ì…ì–´ì„œ ë”ìš¸ ìˆ˜ ìˆì–´ìš”. í™œë™ì„ ë°©í•´í•˜ì§€ ì•Šì„ ì •ë„ë¡œ ëœ ê»´ì…ì–´ë„ ê´œì°®ì•„ìš”.");
      }
    }
    if ((sc.key === "rainySchool" || sc.key === "waterPlay") && !rainScoreFlag) {
      badLines.push("Â· ë¹„ë‚˜ ë¬¼ì— ì –ì„ ìˆ˜ ìˆëŠ” ë‚ ì¸ë°, ìš°ë¹„ë‚˜ ë ˆì¸ë¶€ì¸ ì²˜ëŸ¼ ë°©ìˆ˜ê°€ ë˜ëŠ” ì˜·ì´ë‚˜ ì‹ ë°œì„ ê³ ë¥´ì§€ ì•Šì•˜ì–´ìš”.");
    }
    if (activityScore <= (sc.weights.activity || 0) * 0.4) {
      badLines.push("Â· ì›€ì§ì´ê¸° í¸í•˜ì§€ ì•Šì€ ì˜·ì´ ìˆì–´ìš”. ì²´ìœ¡Â·í™œë™ ìƒí™©ì—ì„œëŠ” íŠ¸ë ˆì´ë‹ë³µ, ìš´ë™í™”ì²˜ëŸ¼ í™œë™ì„±ì´ ì¢‹ì€ ì˜·ì„ ê³¨ë¼ë³´ì„¸ìš”.");
    }
    if (safetyScore <= (sc.weights.safety || 0) * 0.4) {
      badLines.push("Â· ê¸´ ëˆì´ë‚˜ í° ì¥ì‹ êµ¬, ìœ„í—˜í•œ ì‹ ë°œ ë“±ì´ ìˆì–´ ë‹¤ì¹  ìˆ˜ ìˆì–´ìš”. ì¥ì‹ì´ ì ê³  ë°œì„ ì˜ ì¡ì•„ì£¼ëŠ” ì‹ ë°œì´ ë” ì•ˆì „í•´ìš”.");
    }
    if (etiquetteScore <= (sc.weights.etiquette || 0) * 0.4) {
      badLines.push("Â· ì´ ìƒí™©ì—ì„œëŠ” ì¡°ê¸ˆ ë” ë‹¨ì •í•œ ì˜·ì„ ì…ëŠ” ê²ƒì´ ì¢‹ì•„ìš”. ë¬¸êµ¬ë‚˜ ê·¸ë¦¼ì´ ë„ˆë¬´ ê³¼í•˜ì§€ ì•Šì€ ì˜·ì„ ê³¨ë¼ë³´ì„¸ìš”.");
    }
    if (missingRequired.length > 0) {
      badLines.push("Â· ìƒì˜, í•˜ì˜, ì‹ ë°œì€ ê¼­ ëª¨ë‘ ê³¨ë¼ì•¼ í•´ìš”. ë¹ ì§„ ë¶€ë¶„ì´ ì—†ëŠ”ì§€ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•´ ë³´ì„¸ìš”.");
    }

    feedbackLines.push(`â–¶ ${SCENARIOS[currentScenarioKey].name} ì˜·ì°¨ë¦¼ í‰ê°€\n`);
    if (goodLines.length) {
      feedbackLines.push("â— ì˜í•œ ì ");
      feedbackLines.push(...goodLines);
      feedbackLines.push("");
    }
    if (badLines.length) {
      feedbackLines.push("â— ë” ì¢‹ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì ");
      feedbackLines.push(...badLines);
    } else if (!goodLines.length) {
      feedbackLines.push("Â· ì´ë²ˆ ì„ íƒì„ ë°”íƒ•ìœ¼ë¡œ, ìƒí™©ê³¼ ë‚ ì”¨ë¥¼ í•œ ë²ˆ ë” ìƒê°í•´ ë³´ë©´ì„œ ë‹¤ë¥¸ ì¡°í•©ë„ ë§Œë“¤ì–´ ë³´ë©´ ì¢‹ì•„ìš”.");
    }

    let badge = "";
    if (totalScore >= 90) {
      badge = "ì™„ì „ ë©‹ì§„ ì„ íƒ! ìƒí™©Â·ë‚ ì”¨Â·ì˜ˆì ˆì„ ëª¨ë‘ ì˜ ê³ ë ¤í•œ ì˜·ì°¨ë¦¼ì´ì—ìš”. ğŸ‘";
    } else if (totalScore >= 75) {
      badge = "ê½¤ ì¢‹ì€ ì„ íƒì´ì—ìš”. í•œë‘ ë¶€ë¶„ë§Œ ë” ë‹¤ë“¬ìœ¼ë©´ ë” ì™„ë²½í•´ì§ˆ ìˆ˜ ìˆì–´ìš”.";
    } else if (totalScore >= 50) {
      badge = "ê¸°ë³¸ì€ ì¡í˜€ ìˆì§€ë§Œ, ë‚ ì”¨Â·ì•ˆì „Â·ì˜ˆì ˆ ì¤‘ í•œ ê°€ì§€ ì´ìƒì„ ë‹¤ì‹œ ìƒê°í•´ ë³´ë©´ ì¢‹ì•„ìš”.";
    } else {
      badge = "ì´ë²ˆ ì˜·ì°¨ë¦¼ì„ ê³„ê¸°ë¡œ, ìƒí™©ì— ë§ëŠ” ì˜·ì°¨ë¦¼ì„ ë‹¤ì‹œ í•œ ë²ˆ ì •ë¦¬í•´ ë³´ë©´ ì¢‹ê² ì–´ìš”.";
    }

    return {
      score: totalScore,
      badge,
      feedback: feedbackLines.join("\n"),
      items,
      warmthSum,
      actAvg,
      riskSum,
      etiAvg
    };
  }

  function renderResult(result) {
    const sc = SCENARIOS[currentScenarioKey];
    document.getElementById("resultScore").textContent = result.score;
    document.getElementById("resultBadge").textContent = result.badge;

    const fb = document.getElementById("feedbackBox");
    fb.textContent = result.feedback;
    fb.classList.remove("good", "bad");
    if (result.score >= 75) fb.classList.add("good");
    else fb.classList.add("bad");

    const listEl = document.getElementById("resultSummaryList");
    listEl.innerHTML = "";

    const li1 = document.createElement("li");
    li1.textContent = `ì „ì²´ ë”°ëœ»í•¨ í•©ê³„: ${result.warmthSum.toFixed(1)}`;
    const li2 = document.createElement("li");
    li2.textContent = `í™œë™ì„± í‰ê· : ${result.actAvg.toFixed(2)} (1~3)`;
    const li3 = document.createElement("li");
    li3.textContent = `ìœ„í—˜ ìš”ì†Œ í•©ê³„: ${result.riskSum.toFixed(1)} (ë‚®ì„ìˆ˜ë¡ ì•ˆì „)`;
    const li4 = document.createElement("li");
    li4.textContent = `ì˜ˆì ˆ ì ìˆ˜ í‰ê· : ${result.etiAvg.toFixed(2)} (1~3)`;
    const li5 = document.createElement("li");
    li5.textContent = "ì„ íƒí•œ ì˜·: " + (result.items.length
      ? result.items.map(it => it.name).join(", ")
      : "ì„ íƒí•œ ì˜·ì´ ì—†ìŠµë‹ˆë‹¤.");

    [li1, li2, li3, li4, li5].forEach(li => listEl.appendChild(li));

    // ê²¨ìš¸/ë¹„/ë¬¼ë†€ì´ ìƒí™©ìš© ì¶”ê°€ í•œ ì¤„ (ì„ íƒ)
    if (currentScenarioKey === "winterTrip") {
      const li6 = document.createElement("li");
      li6.textContent = `ê²¨ìš¸ ì˜·ì°¨ë¦¼ìœ¼ë¡œ ë´¤ì„ ë•Œ ë”°ëœ»í•¨ì€ ${
        result.warmthSum >= sc.idealWarmth + 1 ? "ê½¤ ì¶©ë¶„" :
        result.warmthSum <= sc.idealWarmth - 1 ? "ì¡°ê¸ˆ ë¶€ì¡±" :
        "ì ë‹¹"
      }í•œ í¸ì´ì—ìš”.`;
      listEl.appendChild(li6);
    }
  }

  // --------- ì´ë²¤íŠ¸ ë°”ì¸ë”© ---------
  document.addEventListener("DOMContentLoaded", () => {
    renderScenarioCards();

    document.getElementById("btnScenarioNext").addEventListener("click", () => {
      if (!currentScenarioKey) return;
      currentStoryIndex = 0;
      renderStory();
      showScreen("screen-story");
    });

    document.getElementById("btnStoryBack").addEventListener("click", () => {
      showScreen("screen-scenario");
    });

    document.getElementById("btnStoryNext").addEventListener("click", () => {
      const sc = SCENARIOS[currentScenarioKey];
      if (currentStoryIndex < sc.storyPages.length - 1) {
        currentStoryIndex += 1;
        renderStory();
      } else {
        renderDressScreen();
        showScreen("screen-dress");
      }
    });

    document.getElementById("btnDressBack").addEventListener("click", () => {
      showScreen("screen-story");
    });

    document.getElementById("btnEvaluate").addEventListener("click", () => {
      const result = evaluateOutfit();
      renderResult(result);
      showScreen("screen-result");
    });

    document.getElementById("btnResultBack").addEventListener("click", () => {
      showScreen("screen-dress");
    });

    document.getElementById("btnRestart").addEventListener("click", () => {
      currentScenarioKey = null;
      currentStoryIndex = 0;
      renderScenarioCards();
      document.getElementById("btnScenarioNext").disabled = true;
      showScreen("screen-scenario");
    });
  });
</script>
</body>
</html>
